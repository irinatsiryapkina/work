CREATE OR REPLACE VIEW "eia"."aeo_2018" AS (
  SELECT "year"
       , "generation_electricity_high"       / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "generation_electricity_high"
       , "generation_electricity_low"        / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "generation_electricity_low"
       , "generation_electricity_reference"  / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "generation_electricity_reference"
       , "commercial_electricity_high"       / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "commercial_electricity_high"
       , "commercial_electricity_low"        / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "commercial_electricity_low"
       , "commercial_electricity_reference"  / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE')                                                                                                       AS "commercial_electricity_reference"
       , "commercial_nat_gas_high"           / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "commercial_nat_gas_high"
       , "commercial_nat_gas_low"            / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "commercial_nat_gas_low"
       , "commercial_nat_gas_reference"      / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "commercial_nat_gas_reference"
       , "crude_oil_avg_wellhead_high"       / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon' AND "to_unit" = 'barrel') * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon crude' AND "to_unit" = 'GGE') AS "crude_oil_avg_wellhead_high"
       , "crude_oil_avg_wellhead_low"        / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon' AND "to_unit" = 'barrel') * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon crude' AND "to_unit" = 'GGE') AS "crude_oil_avg_wellhead_low"
       , "crude_oil_avg_wellhead_reference"  / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon' AND "to_unit" = 'barrel') * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon crude' AND "to_unit" = 'GGE') AS "crude_oil_avg_wellhead_reference"
       , "diesel_fuel_high"                  / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon diesel'  AND "to_unit" = 'GGE')                                                                                                    AS "diesel_fuel_high"
       , "diesel_fuel_low"                   / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon diesel'  AND "to_unit" = 'GGE')                                                                                                    AS "diesel_fuel_low"
       , "diesel_fuel_reference"             / (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'gallon diesel'  AND "to_unit" = 'GGE')                                                                                                    AS "diesel_fuel_reference"
       , "gasoline_fuel_high"                                                                                                                                                                                                                             AS "gasoline_fuel_high"
       , "gasoline_fuel_low"                                                                                                                                                                                                                              AS "gasoline_fuel_low"
       , "gasoline_fuel_reference"                                                                                                                                                                                                                        AS "gasoline_fuel_reference"
       , "avg_delivered_ng_high"             / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "avg_delivered_ng_high"
       , "avg_delivered_ng_low"              / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "avg_delivered_ng_low"
       , "avg_delivered_reference"           / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')                                                                                           AS "avg_delivered_reference"
       , ("commercial_electricity_high"      / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE'))             * (2/3)
       + ("commercial_nat_gas_high"          / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')) * (1/3)                                                                                  AS "chp_high"
       , ("commercial_electricity_low"       / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE'))             * (2/3)
       + ("commercial_nat_gas_low"           / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')) * (1/3)                                                                                  AS "chp_low"
       , ("commercial_electricity_reference" / 100.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'kWh' AND "to_unit" = 'GGE'))             * (2/3)
       + ("commercial_nat_gas_reference"     / 1000.0 * (SELECT "factor" FROM "admin"."conversions" WHERE "from_unit" = 'cubic feet CNG' AND "to_unit" = 'GGE')) * (1/3)                                                                                  AS "chp_reference"
  FROM "eia"."aeo_2018_20190129"
);

COMMENT ON VIEW "eia"."aeo_2018" IS 'EIA AEO 2018 projections in USD per GGE.';
